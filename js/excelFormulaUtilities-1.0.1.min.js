(function(){if(typeof window==="undefined"){window=root}var a=window.excelFormulaUtilities=window.excelFormulaUtilities||{};var e=window.excelFormulaUtilities.core={};window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};var g=window.excelFormulaUtilities.string.formatStr=function(m){var o=m;var l=1;for(;l<arguments.length;l++){var n=(l-1);var k=new RegExp("\\{{1}"+n.toString()+"{1}\\}{1}","g");o=o.replace(k,arguments[l])}return o};var f=window.excelFormulaUtilities.string.trim=function(k){return k.replace(/^\s|\s$/,"")};var b=window.excelFormulaUtilities.string.trim=function(k){return k.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")};var c=e.isFunction=function(k){return(typeof k)==="function"};var h=e.isArray=function(k){return(typeof k)==="object"&&k.length};var d=e.isWindow=function(){return obj&&typeof obj==="object"&&"setInterval" in obj};var j=e.isPlainObject=function(l){if(!l||typeof l!=="object"||l.nodeType||d(l)){return false}if(l.constructor&&!hasOwnProperty.call(l,"constructor")&&!hasOwnProperty.call(l.constructor.prototype,"isPrototypeOf")){return false}var k;for(k in l){}return k===undefined||hasOwnProperty.call(l,k)};var i=e.extend=function(){var t,m,k,l,q,r,p=arguments[0]||{},o=1,n=arguments.length,s=false;if(typeof p==="boolean"){s=p;p=arguments[1]||{};o=2}if(typeof p!=="object"&&!c(p)){p={}}if(n===o){p=this;--o}for(;o<n;o++){if((t=arguments[o])!=null){for(m in t){k=p[m];l=t[m];if(p===l){continue}if(s&&l&&(j(l)||(q=h(l)))){if(q){q=false;r=k&&h(k)?k:[]}else{r=k&&j(k)?k:{}}p[m]=e.extend(s,r,l)}else{if(l!==undefined){p[m]=l}}}}}return p}}());(function(u){var D=u.excelFormulaUtilities=u.excelFormulaUtilities||{},x=u.excelFormulaUtilities.core,c=u.excelFormulaUtilities.string.formatStr,a=u.excelFormulaUtilities.string.trim,H={},E=H.TOK_TYPE_NOOP="noop",r=H.TOK_TYPE_OPERAND="operand",L=H.TOK_TYPE_FUNCTION="function",b=H.TOK_TYPE_SUBEXPR="subexpression",I=H.TOK_TYPE_ARGUMENT="argument",F=H.TOK_TYPE_OP_PRE="operator-prefix",N=H.TOK_TYPE_OP_IN="operator-infix",d=H.TOK_TYPE_OP_POST="operator-postfix",z=H.TOK_TYPE_WSPACE="white-space",v=H.TOK_TYPE_UNKNOWN="unknown",y=H.TOK_SUBTYPE_START="start",e=H.TOK_SUBTYPE_STOP="stop",n=H.TOK_SUBTYPE_TEXT="text",q=H.TOK_SUBTYPE_NUMBER="number",G=H.TOK_SUBTYPE_LOGICAL="logical",A=H.TOK_SUBTYPE_ERROR="error",i=H.TOK_SUBTYPE_RANGE="range",o=H.TOK_SUBTYPE_MATH="math",M=H.TOK_SUBTYPE_CONCAT="concatenate",p=H.TOK_SUBTYPE_INTERSECT="intersect",C=H.TOK_SUBTYPE_UNION="union";u.excelFormulaUtilities.isEu=typeof u.excelFormulaUtilities.isEu==="boolean"?u.excelFormulaUtilities.isEu:false;function w(Q,P,O){this.value=Q;this.type=P;this.subtype=O}function l(){this.items=[];this.add=function(R,Q,O){if(!O){O=""}var P=new w(R,Q,O);this.addRef(P);return P};this.addRef=function(O){this.items.push(O)};this.index=-1;this.reset=function(){this.index=-1};this.BOF=function(){return(this.index<=0)};this.EOF=function(){return(this.index>=(this.items.length-1))};this.moveNext=function(){if(this.EOF()){return false}this.index+=1;return true};this.current=function(){if(this.index===-1){return null}return(this.items[this.index])};this.next=function(){if(this.EOF()){return null}return(this.items[this.index+1])};this.previous=function(){if(this.index<1){return null}return(this.items[this.index-1])}}function h(){this.items=[];this.push=function(O){this.items.push(O)};this.pop=function(O){var P=this.items.pop();return(new w(O||"",P.type,e))};this.token=function(){return((this.items.length>0)?this.items[this.items.length-1]:null)};this.value=function(){return((this.token())?this.token().value.toString():"")};this.type=function(){return((this.token())?this.token().type.toString():"")};this.subtype=function(){return((this.token())?this.token().subtype.toString():"")}}function f(Y){var aa=new l(),Z=new h(),V=0,ac=function(){return Y.substr(V,1)},Q=function(){return Y.substr(V,2)},R=function(){return Y.substr(V+1,1)},X=function(){return(V>=Y.length)},S="",W=false,ad=false,ab=false,P=false,U=/^[1-9]{1}(\.[0-9]+)?E{1}$/;while(Y.length>0){if(Y.substr(0,1)===" "){Y=Y.substr(1)}else{if(Y.substr(0,1)==="="){Y=Y.substr(1)}break}}while(!X()){if(W){if(ac()==='"'){if(R()==='"'){S+='"';V+=1}else{W=false;aa.add(S,r,n);S=""}}else{S+=ac()}V+=1;continue}if(ad){if(ac()==="'"){if(R()==="'"){S+="'";V+=1}else{ad=false;S+="'"}}else{S+=ac()}V+=1;continue}if(ab){if(ac()==="]"){ab=false}S+=ac();V+=1;continue}if(P){S+=ac();V+=1;if((",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,").indexOf(","+S+",")!==-1){P=false;aa.add(S,r,A);S=""}continue}if(("+-").indexOf(ac())!==-1){if(S.length>1){if(S.match(U)){S+=ac();V+=1;continue}}}if(ac()==='"'){if(S.length>0){aa.add(S,v);S=""}W=true;V+=1;continue}if(ac()==="'"){if(S.length>0){aa.add(S,v);S=""}S="'";ad=true;V+=1;continue}if(ac()==="["){ab=true;S+=ac();V+=1;continue}if(ac()==="#"){if(S.length>0){aa.add(S,v);S=""}P=true;S+=ac();V+=1;continue}if(ac()==="{"){if(S.length>0){aa.add(S,v);S=""}Z.push(aa.add("ARRAY",L,y));Z.push(aa.add("ARRAYROW",L,y));V+=1;continue}if(ac()===";"){if(u.excelFormulaUtilities.isEu){if(S.length>0){aa.add(S,r);S=""}if(Z.type()!==L){aa.add(ac(),N,C)}else{aa.add(ac(),I)}V+=1;continue}else{if(S.length>0){aa.add(S,r);S=""}aa.addRef(Z.pop());aa.add(",",I);Z.push(aa.add("ARRAYROW",L,y));V+=1;continue}}if(ac()==="}"){if(S.length>0){aa.add(S,r);S=""}aa.addRef(Z.pop("ARRAYROWSTOP"));aa.addRef(Z.pop("ARRAYSTOP"));V+=1;continue}if(ac()===" "){if(S.length>0){aa.add(S,r);S=""}aa.add("",z);V+=1;while((ac()===" ")&&(!X())){V+=1}continue}if((",>=,<=,<>,").indexOf(","+Q()+",")!==-1){if(S.length>0){aa.add(S,r);S=""}aa.add(Q(),N,G);V+=2;continue}if(("+-*/^&=><").indexOf(ac())!==-1){if(S.length>0){aa.add(S,r);S=""}aa.add(ac(),N);V+=1;continue}if(("%").indexOf(ac())!==-1){if(S.length>0){aa.add(S,r);S=""}aa.add(ac(),d);V+=1;continue}if(ac()==="("){if(S.length>0){Z.push(aa.add(S,L,y));S=""}else{Z.push(aa.add("",b,y))}V+=1;continue}if(ac()===","&&!u.excelFormulaUtilities.isEu){if(S.length>0){aa.add(S,r);S=""}if(Z.type()!==L){aa.add(ac(),N,C)}else{aa.add(ac(),I)}V+=1;continue}if(ac()===")"){if(S.length>0){aa.add(S,r);S=""}aa.addRef(Z.pop());V+=1;continue}S+=ac();V+=1}if(S.length>0){aa.add(S,r)}var O=new l();while(aa.moveNext()){S=aa.current();if(S.type.toString()===z){var T=(aa.BOF())||(aa.EOF());T=T&&(((aa.previous().type.toString()===L)&&(aa.previous().subtype.toString()===e))||((aa.previous().type.toString()===b)&&(aa.previous().subtype.toString()===e))||(aa.previous().type.toString()===r));T=T&&(((aa.next().type.toString()===L)&&(aa.next().subtype.toString()===y))||((aa.next().type.toString()===b)&&(aa.next().subtype.toString()===y))||(aa.next().type.toString()===r));if(T){O.add(S.value.toString(),N,p)}continue}O.addRef(S)}while(O.moveNext()){S=O.current();if((S.type.toString()===N)&&(S.value.toString()==="-")){if(O.BOF()){S.type=F.toString()}else{if(((O.previous().type.toString()===L)&&(O.previous().subtype.toString()===e))||((O.previous().type.toString()===b)&&(O.previous().subtype.toString()===e))||(O.previous().type.toString()===d)||(O.previous().type.toString()===r)){S.subtype=o.toString()}else{S.type=F.toString()}}continue}if((S.type.toString()===N)&&(S.value.toString()==="+")){if(O.BOF()){S.type=E.toString()}else{if(((O.previous().type.toString()===L)&&(O.previous().subtype.toString()===e))||((O.previous().type.toString()===b)&&(O.previous().subtype.toString()===e))||(O.previous().type.toString()===d)||(O.previous().type.toString()===r)){S.subtype=o.toString()}else{S.type=E.toString()}}continue}if((S.type.toString()===N)&&(S.subtype.length===0)){if(("<>=").indexOf(S.value.substr(0,1))!==-1){S.subtype=G.toString()}else{if(S.value.toString()==="&"){S.subtype=M.toString()}else{S.subtype=o.toString()}}continue}if((S.type.toString()===r)&&(S.subtype.length===0)){if(isNaN(parseFloat(S.value))){if((S.value.toString()==="TRUE")||(S.value.toString()==="FALSE")){S.subtype=G.toString()}else{S.subtype=i.toString()}}else{S.subtype=q.toString()}continue}if(S.type.toString()===L){if(S.value.substr(0,1)==="@"){S.value=S.value.substr(1).toString()}continue}}O.reset();aa=new l();while(O.moveNext()){if(O.current().type.toString()!==E){aa.addRef(O.current())}}aa.reset();return aa}var s=D.parseFormula=function(O,V){var R=0;var P=function(){var Y="|",X=0;for(;X<R;X+=1){Y+="&nbsp;&nbsp;&nbsp;|"}return Y};var S=document.getElementById(O);var T=S.value;var U=f(T);var W="";W+="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'>";W+="<tr>";W+="<td class='token' style='font-weight: bold; width: 50px'>index</td>";W+="<td class='token' style='font-weight: bold; width: 125px'>type</td>";W+="<td class='token' style='font-weight: bold; width: 125px'>subtype</td>";W+="<td class='token' style='font-weight: bold; width: 150px'>token</td>";W+="<td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";while(U.moveNext()){var Q=U.current();if(Q.subtype===e){R-=((R>0)?1:0)}W+="<tr>";W+="<td class='token'>"+(U.index+1)+"</td>";W+="<td class='token'>"+Q.type+"</td>";W+="<td class='token'>"+((Q.subtype.length===0)?"&nbsp;":Q.subtype.toString())+"</td>";W+="<td class='token'>"+((Q.value.length===0)?"&nbsp;":Q.value).split(" ").join("&nbsp;")+"</td>";W+="<td class='token'>"+P()+((Q.value.length===0)?"&nbsp;":Q.value).split(" ").join("&nbsp;")+"</td>";W+="</tr>";if(Q.subtype===y){R+=1}}W+="</table>";document.getElementById(V).innerHTML=W;S.select();S.focus()};function m(Q,T){if(!RegExp("[a-z]+[0-9]+:[a-z]+[0-9]+","gi").test(Q)){throw"This is not a valid range: "+Q}var P=Q.split(":"),O=parseInt(P[0].match(/[0-9]+/gi)[0]),R=P[0].match(/[A-Z]+/gi)[0],S=J(R);endRow=parseInt(P[1].match(/[0-9]+/gi)[0]),endCol=P[1].match(/[A-Z]+/gi)[0],endColDec=J(endCol),totalRows=endRow-O+1,totalCols=J(endCol)-J(R)+1,curCol=0,curRow=1,curCell="",retStr="";for(;curRow<=totalRows;curRow+=1){for(;curCol<totalCols;curCol+=1){curCell=t(S+curCol)+""+(O+curRow-1);retStr+=curCell+(curRow===totalRows&&curCol===totalCols-1?"":T)}curCol=0}return retStr}var t=D.toBase26=function(Q){Q=Math.abs(Q);var R="",O=false,P;do{P=Q%26;if(O&&Q<25){P--}R=String.fromCharCode((P+"A".charCodeAt(0)))+R;Q=Math.floor((Q-P)/26);O=true}while(Q>0);return R};var J=D.fromBase26=function(Q){Q=Q.toUpperCase();var P=0,O=0,R=0;if(Q!==null&&typeof Q!=="undefined"&&Q.length>0){for(;O<Q.length;O++){P=Q.charCodeAt(Q.length-O-1)-"A".charCodeAt(0);R+=(Math.pow(26,O))*(P+1)}}return R-1};function B(R,X,P,U,O){var T=P;var Q=typeof arguments[5]===undefined||arguments[5]===null?null:arguments[5];var W=function(Y){return Y.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")};var V="";if(R.subtype==="text"||R.type==="text"){V=R.value.toString()}else{if(R.type==="operand"&&R.subtype==="range"){V=R.value.toString()}else{V=((R.value.length===0)?" ":R.value.toString()).split(" ").join("").toString()}}if(typeof O==="function"){var S=O(V,R,P,U);V=S.tokenString;if(!S.useTemplate){return V}}switch(R.type){case"function":switch(R.value){case"ARRAY":V=c(W(X.tmplFunctionStartArray),V,T,U);break;case"ARRAYROW":V=c(W(X.tmplFunctionStartArrayRow),V,T,U);break;default:if(R.subtype.toString()==="start"){V=c(W(X.tmplFunctionStart),V,T,U)}else{V=c(W(X.tmplFunctionStop),V,T,U)}break}break;case"operand":switch(R.subtype.toString()){case"error":V=c(W(X.tmplOperandError),V,T,U);break;case"range":V=c(W(X.tmplOperandRange),V,T,U);break;case"number":V=c(W(X.tmplOperandNumber),V,T,U);break;case"text":V=c(W(X.tmplOperandText),V,T,U);break;case"argument":V=c(W(X.tmplArgument),V,T,U);break;default:break}break;case"operator-infix":case"logical":V=c(W(X.tmplOperandLogical),V,T,U);break;case"argument":if(Q.type!=="argument"){V=c(W(X.tmplArgument),V,T,U)}else{V=c(W("{{autoindent}}"+X.tmplArgument),V,T,U)}break;case"subexpression":if(R.subtype.toString()==="start"){V=c(W(X.tmplSubexpressionStart),V,T,U)}else{V=c(W(X.tmplSubexpressionStop),V,T,U)}break;default:break}return V}var k=D.formatFormula=function(Q,S){Q=Q.replace(/^\s*=\s+/,"=");var aa=true,af={tmplFunctionStart:"{{autoindent}}{{token}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:" {{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(\n",tmplSubexpressionStop:"\n)",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",customTokenRender:null,prefix:"",postfix:""};if(S){S=x.extend(true,af,S)}else{S=af}var ah=0;var X=function(){var aj="",ai=0;for(;ai<ah;ai+=1){aj+=S.tmplIndentTab}return aj};var Y=f(Q);var ab="";var T=S.autoLineBreak.replace(/\s/gi,"").split("|");var ag=true;var Z=function(ai){var aj=0;for(;aj<T.length;aj+=1){if(ai!==null&&typeof ai!=="undefined"&&(H[T[aj]]===ai.type.toString()||H[T[aj]]===ai.subtype.toString())){return true}}return false};var ae=null;while(Y.moveNext()){var U=Y.current();var W=Y.next();if(U.subtype.toString()===e){ah-=((ah>0)?1:0)}var O=new RegExp("^"+S.newLine,""),ad=new RegExp(S.newLine+"$",""),P=Z(W),ac=ag,R=ac?X():S.tmplIndentSpace,V=P?S.newLine:"";ab+=B(U,S,R,V,S.customTokenRender,ae);if(U.subtype.toString()===y){ah+=1}ag=P||ad.test(ab);aa=false;ae=U}ab=S.prefix+a(ab)+S.postfix;return ab};var K=D.formatFormulaHTML=function(P){var O={tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><span class="function_start">(</span><br />',tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',tmplArgument:"{{token}}<br />",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",tmplIndentTab:'<span class="tabbed">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:true,prefix:"=",customTokenRender:null};return k(P,O)};var g=D.formula2CSharp=function(R){var O=[];var P=function(V,T,S,W){var U="",Z=V,Y={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},aa=O[O.length-1],X=false;switch(T.type.toString()){case L:switch(T.subtype){case y:O.push({name:Z,argumentNumber:0});U=typeof Y[Z.toUpperCase()]==="string"?Y[Z.toUpperCase()]:Z;X=true;break;case e:X=true;switch(aa.name.toLowerCase()){case"if":U=")";X=false;break;default:U=typeof Y[Z.toUpperCase()]==="string"?Y[Z.toUpperCase()]:Z;break}O.pop();break}break;case I:switch(aa.name.toLowerCase()){case"if":switch(aa.argumentNumber){case 0:U="?";break;case 1:U=":";break}break;case"sum":U="+";break;default:U=typeof Y[Z.toUpperCase()]==="string"?Y[Z.toUpperCase()]:Z;X=true;break}aa.argumentNumber+=1;break;case r:switch(T.subtype){case i:switch(aa.name.toLowerCase()){case"sum":if(RegExp(":","gi").test(Z)){U=m(Z,"+")}else{outStr=Z}break;default:if(RegExp(":","gi").test(Z)){U="["+m(Z,",")+"]"}else{U=Z}break}break;default:break}default:if(U===""){U=typeof Y[Z.toUpperCase()]==="string"?Y[Z.toUpperCase()]:Z}X=true;break}return{tokenString:U,useTemplate:X}};var Q=k(R,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',tmplArgument:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",trim:true,customTokenRender:P});return Q};var j=D.formula2JavaScript=function(O){return g(O).replace("==","===")};D.getTokens=f}(window||module.exports||{}));