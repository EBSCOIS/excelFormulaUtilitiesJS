(function(){"undefined"===typeof window&&(window=root);window.excelFormulaUtilities=window.excelFormulaUtilities||{};var u=window.excelFormulaUtilities.core={};window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};window.excelFormulaUtilities.string.formatStr=function(k){for(var l=k,q=1;q<arguments.length;q++)l=l.replace(RegExp("\\{{1}"+(q-1).toString()+"{1}\\}{1}","g"),arguments[q]);return l};window.excelFormulaUtilities.string.trim=function(k){return k.replace(/^\s|\s$/,"")};
window.excelFormulaUtilities.string.trim=function(k){return k.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")};var x=u.isFunction=function(k){return"function"===typeof k},A=u.isArray=function(k){return"object"===typeof k&&k.length},v=u.isWindow=function(){return obj&&"object"===typeof obj&&"setInterval"in obj},y=u.isPlainObject=function(k){if(!k||("object"!==typeof k||k.nodeType||v(k))||k.constructor&&!hasOwnProperty.call(k,"constructor")&&!hasOwnProperty.call(k.constructor.prototype,
"isPrototypeOf"))return!1;for(var l in k);return void 0===l||hasOwnProperty.call(k,l)};u.extend=function(){var k,l,q,m,v,g=arguments[0]||{},r=1,p=arguments.length,n=!1;"boolean"===typeof g&&(n=g,g=arguments[1]||{},r=2);"object"!==typeof g&&!x(g)&&(g={});p===r&&(g=this,--r);for(;r<p;r++)if(null!=(k=arguments[r]))for(l in k)q=g[l],m=k[l],g!==m&&(n&&m&&(y(m)||(v=A(m)))?(v?(v=!1,q=q&&A(q)?q:[]):q=q&&y(q)?q:{},g[l]=u.extend(n,q,m)):void 0!==m&&(g[l]=m));return g}})();(function(){function u(d,c,b){this.value=d;this.type=c;this.subtype=b}function x(){this.items=[];this.add=function(d,c,b){b||(b="");d=new u(d,c,b);this.addRef(d);return d};this.addRef=function(d){this.items.push(d)};this.index=-1;this.reset=function(){this.index=-1};this.BOF=function(){return 0>=this.index};this.EOF=function(){return this.index>=this.items.length-1};this.moveNext=function(){if(this.EOF())return!1;this.index+=1;return!0};this.current=function(){return-1===this.index?null:this.items[this.index]};
this.next=function(){return this.EOF()?null:this.items[this.index+1]};this.previous=function(){return 1>this.index?null:this.items[this.index-1]}}function A(){this.items=[];this.push=function(d){this.items.push(d)};this.pop=function(d){var c=this.items.pop();return new u(d||"",c.type,s)};this.token=function(){return 0<this.items.length?this.items[this.items.length-1]:null};this.value=function(){return this.token()?this.token().value.toString():""};this.type=function(){return this.token()?this.token().type.toString():
""};this.subtype=function(){return this.token()?this.token().subtype.toString():""}}function v(d){for(var c=new x,b=new A,e=0,f=function(){return d.substr(e,1)},a="",j=!1,h=!1,g=!1,k=!1,m=/^[1-9]{1}(\.[0-9]+)?E{1}$/;0<d.length;)if(" "===d.substr(0,1))d=d.substr(1);else{"="===d.substr(0,1)&&(d=d.substr(1));break}for(;!(e>=d.length);)if(j)'"'===f()?'"'===d.substr(e+1,1)?(a+='"',e+=1):(j=!1,c.add(a,p,M),a=""):a+=f(),e+=1;else if(h)"'"===f()?"'"===d.substr(e+1,1)?(a+="'",e+=1):h=!1:a+=f(),e+=1;else if(g)"]"===
f()&&(g=!1),a+=f(),e+=1;else if(k)a+=f(),e+=1,-1!==",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,".indexOf(","+a+",")&&(k=!1,c.add(a,p,N),a="");else if(-1!=="+-".indexOf(f())&&1<a.length&&a.match(m))a+=f(),e+=1;else if('"'===f())0<a.length&&(c.add(a,B),a=""),j=!0,e+=1;else if("'"===f())0<a.length&&(c.add(a,B),a=""),h=!0,e+=1;else if("["===f())g=!0,a+=f(),e+=1;else if("#"===f())0<a.length&&(c.add(a,B),a=""),k=!0,a+=f(),e+=1;else if("{"===f())0<a.length&&(c.add(a,B),a=""),b.push(c.add("ARRAY",n,
t)),b.push(c.add("ARRAYROW",n,t)),e+=1;else if(";"===f())0<a.length&&(c.add(a,p),a=""),c.addRef(b.pop()),c.add(",",D),b.push(c.add("ARRAYROW",n,t)),e+=1;else if("}"===f())0<a.length&&(c.add(a,p),a=""),c.addRef(b.pop("ARRAYROWSTOP")),c.addRef(b.pop("ARRAYSTOP")),e+=1;else if(" "===f()){0<a.length&&(c.add(a,p),a="");c.add("",H);for(e+=1;" "===f()&&!(e>=d.length);)e+=1}else-1!==",>=,<=,<>,".indexOf(","+d.substr(e,2)+",")?(0<a.length&&(c.add(a,p),a=""),c.add(d.substr(e,2),w,E),e+=2):(-1!=="+-*/^&=><".indexOf(f())?
(0<a.length&&(c.add(a,p),a=""),c.add(f(),w)):-1!=="%".indexOf(f())?(0<a.length&&(c.add(a,p),a=""),c.add(f(),F)):"("===f()?0<a.length?(b.push(c.add(a,n,t)),a=""):b.push(c.add("",z,t)):","===f()?(0<a.length&&(c.add(a,p),a=""),b.type()!==n?c.add(f(),w,O):c.add(f(),D)):")"===f()?(0<a.length&&(c.add(a,p),a=""),c.addRef(b.pop())):a+=f(),e+=1);0<a.length&&c.add(a,p);for(b=new x;c.moveNext();)a=c.current(),a.type.toString()===H?(f=(f=(f=c.BOF()||c.EOF())&&(c.previous().type.toString()===n&&c.previous().subtype.toString()===
s||c.previous().type.toString()===z&&c.previous().subtype.toString()===s||c.previous().type.toString()===p))&&(c.next().type.toString()===n&&c.next().subtype.toString()===t||c.next().type.toString()===z&&c.next().subtype.toString()===t||c.next().type.toString()===p))&&b.add(a.value.toString(),w,P):b.addRef(a);for(;b.moveNext();)a=b.current(),a.type.toString()===w&&"-"===a.value.toString()?b.BOF()?a.type=I.toString():b.previous().type.toString()===n&&b.previous().subtype.toString()===s||b.previous().type.toString()===
z&&b.previous().subtype.toString()===s||b.previous().type.toString()===F||b.previous().type.toString()===p?a.subtype=G.toString():a.type=I.toString():a.type.toString()===w&&"+"===a.value.toString()?b.BOF()?a.type=r.toString():b.previous().type.toString()===n&&b.previous().subtype.toString()===s||b.previous().type.toString()===z&&b.previous().subtype.toString()===s||b.previous().type.toString()===F||b.previous().type.toString()===p?a.subtype=G.toString():a.type=r.toString():a.type.toString()===w&&
0===a.subtype.length?a.subtype=-1!=="<>=".indexOf(a.value.substr(0,1))?E.toString():"&"===a.value.toString()?Q.toString():G.toString():a.type.toString()===p&&0===a.subtype.length?a.subtype=isNaN(parseFloat(a.value))?"TRUE"===a.value.toString()||"FALSE"===a.value.toString()?E.toString():J.toString():R.toString():a.type.toString()===n&&"@"===a.value.substr(0,1)&&(a.value=a.value.substr(1).toString());b.reset();for(c=new x;b.moveNext();)b.current().type.toString()!==r&&c.addRef(b.current());c.reset();
return c}function y(d,c){if(!RegExp("[a-z]+[0-9]+:[a-z]+[0-9]+","gi").test(d))throw"This is not a valid range: "+d;var b=d.split(":"),e=parseInt(b[0].match(/[0-9]+/gi)[0]),f=b[0].match(/[A-Z]+/gi)[0],a=C(f);endRow=parseInt(b[1].match(/[0-9]+/gi)[0]);endCol=b[1].match(/[A-Z]+/gi)[0];endColDec=C(endCol);totalRows=endRow-e+1;totalCols=C(endCol)-C(f)+1;curCol=0;curRow=1;for(retStr=curCell="";curRow<=totalRows;curRow+=1){for(;curCol<totalCols;curCol+=1)curCell=S(a+curCol)+""+(e+curRow-1),retStr+=curCell+
(curRow===totalRows&&curCol===totalCols-1?"":c);curCol=0}return retStr}function k(d,c,b,e,f,a){a=void 0===typeof a||null===a?null:a;var j=function(a){return a.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")},h="",h="text"===d.subtype||"text"===d.type?d.value.toString():(0===d.value.length?" ":d.value.toString()).split(" ").join("").toString();if("function"===typeof f&&(f=f(h,d,b,e),h=f.tokenString,!f.useTemplate))return h;switch(d.type){case "function":switch(d.value){case "ARRAY":h=
m(j(c.tmplFunctionStartArray),h,b,e);break;case "ARRAYROW":h=m(j(c.tmplFunctionStartArrayRow),h,b,e);break;default:h="start"===d.subtype.toString()?m(j(c.tmplFunctionStart),h,b,e):m(j(c.tmplFunctionStop),h,b,e)}break;case "operand":switch(d.subtype.toString()){case "error":h=m(j(c.tmplOperandError),h,b,e);break;case "range":h=m(j(c.tmplOperandRange),h,b,e);break;case "number":h=m(j(c.tmplOperandNumber),h,b,e);break;case "text":h=m(j(c.tmplOperandText),h,b,e);break;case "argument":h=m(j(c.tmplArgument),
h,b,e)}break;case "operator-infix":case "logical":h=m(j(c.tmplOperandLogical),h,b,e);break;case "argument":h="argument"!==a.type?m(j(c.tmplArgument),h,b,e):m(j("{{autoindent}}"+c.tmplArgument),h,b,e);break;case "subexpression":h="start"===d.subtype.toString()?m(j(c.tmplSubexpressionStart),h,b,e):m(j(c.tmplSubexpressionStop),h,b,e)}return h}"undefined"===typeof window&&(window=root);var l=window.excelFormulaUtilities=window.excelFormulaUtilities||{},q=window.excelFormulaUtilities.core,m=window.excelFormulaUtilities.string.formatStr,
L=window.excelFormulaUtilities.string.trim,g={},r=g.TOK_TYPE_NOOP="noop",p=g.TOK_TYPE_OPERAND="operand",n=g.TOK_TYPE_FUNCTION="function",z=g.TOK_TYPE_SUBEXPR="subexpression",D=g.TOK_TYPE_ARGUMENT="argument",I=g.TOK_TYPE_OP_PRE="operator-prefix",w=g.TOK_TYPE_OP_IN="operator-infix",F=g.TOK_TYPE_OP_POST="operator-postfix",H=g.TOK_TYPE_WSPACE="white-space",B=g.TOK_TYPE_UNKNOWN="unknown",t=g.TOK_SUBTYPE_START="start",s=g.TOK_SUBTYPE_STOP="stop",M=g.TOK_SUBTYPE_TEXT="text",R=g.TOK_SUBTYPE_NUMBER="number",
E=g.TOK_SUBTYPE_LOGICAL="logical",N=g.TOK_SUBTYPE_ERROR="error",J=g.TOK_SUBTYPE_RANGE="range",G=g.TOK_SUBTYPE_MATH="math",Q=g.TOK_SUBTYPE_CONCAT="concatenate",P=g.TOK_SUBTYPE_INTERSECT="intersect",O=g.TOK_SUBTYPE_UNION="union";l.parseFormula=function(d,c){var b=0,e=document.getElementById(d),f=v(e.value),a;a="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'><tr>";a+="<td class='token' style='font-weight: bold; width: 50px'>index</td>";a+="<td class='token' style='font-weight: bold; width: 125px'>type</td>";
a+="<td class='token' style='font-weight: bold; width: 125px'>subtype</td>";a+="<td class='token' style='font-weight: bold; width: 150px'>token</td>";for(a+="<td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";f.moveNext();){var j=f.current();j.subtype===s&&(b-=0<b?1:0);a+="<tr>";a+="<td class='token'>"+(f.index+1)+"</td>";a+="<td class='token'>"+j.type+"</td>";a+="<td class='token'>"+(0===j.subtype.length?"&nbsp;":j.subtype.toString())+"</td>";a+="<td class='token'>"+
(0===j.value.length?"&nbsp;":j.value).split(" ").join("&nbsp;")+"</td>";for(var h="|",g=0;g<b;g+=1)h+="&nbsp;&nbsp;&nbsp;|";a+="<td class='token'>"+h+(0===j.value.length?"&nbsp;":j.value).split(" ").join("&nbsp;")+"</td>";a+="</tr>";j.subtype===t&&(b+=1)}a+="</table>";document.getElementById(c).innerHTML=a;e.select();e.focus()};var S=l.toBase26=function(d){d=Math.abs(d);var c="",b=!1,e;do e=d%26,b&&25>d&&e--,c=String.fromCharCode(e+65)+c,d=Math.floor((d-e)/26),b=!0;while(0<d);return c},C=l.fromBase26=
function(d){d=d.toUpperCase();var c=0,b=0,e=0;if(null!==d&&"undefined"!==typeof d&&0<d.length)for(;b<d.length;b++)c=d.charCodeAt(d.length-b-1)-65,e+=Math.pow(26,b)*(c+1);return e-1},K=l.formatFormula=function(d,c){d=d.replace(/^\s*=\s+/gi,"=");var b={tmplFunctionStart:"{{autoindent}}{{token}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:" {{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",
tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(\n",tmplSubexpressionStop:"\n)",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",customTokenRender:null,prefix:"",postfix:""};c=c?q.extend(!0,b,c):b;for(var b=0,e=v(d),f="",a=c.autoLineBreak.replace(/\s/gi,
"").split("|"),j=!0,h=null;e.moveNext();){var m=e.current(),l=e.next();m.subtype.toString()===s&&(b-=0<b?1:0);var p=RegExp(c.newLine+"$","");a:{for(var n=0;n<a.length;n+=1)if(null!==l&&"undefined"!==typeof l&&(g[a[n]]===l.type.toString()||g[a[n]]===l.subtype.toString())){l=!0;break a}l=!1}if(j){j="";for(n=0;n<b;n+=1)j+=c.tmplIndentTab}else j=c.tmplIndentSpace;f+=k(m,c,j,l?c.newLine:"",c.customTokenRender,h);m.subtype.toString()===t&&(b+=1);j=l||p.test(f);h=m}return f=c.prefix+L(f)+c.postfix};l.formatFormulaHTML=
function(d){return K(d,{tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><span class="function_start">(</span><br />',tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',
tmplArgument:"{{token}}<br />",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",tmplIndentTab:'<span class="tabbed">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:!0,prefix:"=",customTokenRender:null})};var T=l.formula2CSharp=function(d){var c=[];
return K(d,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',tmplArgument:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",
trim:!0,customTokenRender:function(b,e){var d="",a={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},g=c[c.length-1],h=!1;switch(e.type.toString()){case n:switch(e.subtype){case t:c.push({name:b,argumentNumber:0});d="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b;h=!0;break;case s:h=!0;switch(g.name.toLowerCase()){case "if":d=")";h=!1;break;default:d="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b}c.pop()}break;case D:switch(g.name.toLowerCase()){case "if":switch(g.argumentNumber){case 0:d=
"?";break;case 1:d=":"}break;case "sum":d="+";break;default:d="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b,h=!0}g.argumentNumber+=1;break;case p:switch(e.subtype){case J:switch(g.name.toLowerCase()){case "sum":RegExp(":","gi").test(b)?d=y(b,"+"):outStr=b;break;default:d=RegExp(":","gi").test(b)?"["+y(b,",")+"]":b}break}default:""===d&&(d="string"===typeof a[b.toUpperCase()]?a[b.toUpperCase()]:b),h=!0}return{tokenString:d,useTemplate:h}}})};l.formula2JavaScript=function(d){return T(d).replace("==",
"===")};l.getTokens=v})();
