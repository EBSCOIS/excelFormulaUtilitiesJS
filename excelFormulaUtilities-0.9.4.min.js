(function(){"undefined"===typeof window&&(window=root);window.excelFormulaUtilities=window.excelFormulaUtilities||{};var s=window.excelFormulaUtilities.core={};window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};window.excelFormulaUtilities.string.formatStr=function(h){for(var n=h,i=1;i<arguments.length;i++)n=n.replace(RegExp("\\{{1}"+(i-1).toString()+"{1}\\}{1}","g"),arguments[i]);return n};window.excelFormulaUtilities.string.trim=function(h){return h.replace(/^\s|\s$/,"")};
window.excelFormulaUtilities.string.trim=function(h){return h.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")};var v=s.isFunction=function(h){return"function"===typeof h},x=s.isArray=function(h){return"object"===typeof h&&h.length},w=s.isWindow=function(){return obj&&"object"===typeof obj&&"setInterval"in obj},y=s.isPlainObject=function(h){if(!h||("object"!==typeof h||h.nodeType||w(h))||h.constructor&&!hasOwnProperty.call(h,"constructor")&&!hasOwnProperty.call(h.constructor.prototype,
"isPrototypeOf"))return!1;for(var n in h);return void 0===n||hasOwnProperty.call(h,n)};s.extend=function(){var h,n,i,p,k,l=arguments[0]||{},m=1,o=arguments.length,t=!1;"boolean"===typeof l&&(t=l,l=arguments[1]||{},m=2);"object"!==typeof l&&!v(l)&&(l={});o===m&&(l=this,--m);for(;m<o;m++)if(null!=(h=arguments[m]))for(n in h)i=l[n],p=h[n],l!==p&&(t&&p&&(y(p)||(k=x(p)))?(k?(k=!1,i=i&&x(i)?i:[]):i=i&&y(i)?i:{},l[n]=s.extend(t,i,p)):void 0!==p&&(l[n]=p));return l}})();(function(){function s(f,b,c){this.value=f;this.type=b;this.subtype=c}function v(){this.items=[];this.add=function(f,b,c){c||(c="");f=new s(f,b,c);this.addRef(f);return f};this.addRef=function(f){this.items.push(f)};this.index=-1;this.reset=function(){this.index=-1};this.BOF=function(){return 0>=this.index};this.EOF=function(){return this.index>=this.items.length-1};this.moveNext=function(){if(this.EOF())return!1;this.index+=1;return!0};this.current=function(){return-1===this.index?null:this.items[this.index]};
this.next=function(){return this.EOF()?null:this.items[this.index+1]};this.previous=function(){return 1>this.index?null:this.items[this.index-1]}}function x(){this.items=[];this.push=function(f){this.items.push(f)};this.pop=function(f){var b=this.items.pop();return new s(f||"",b.type,q)};this.token=function(){return 0<this.items.length?this.items[this.items.length-1]:null};this.value=function(){return this.token()?this.token().value.toString():""};this.type=function(){return this.token()?this.token().type.toString():
""};this.subtype=function(){return this.token()?this.token().subtype.toString():""}}function w(f){for(var b=new v,c=new x,d=0,e=function(){return f.substr(d,1)},a="",j=!1,g=!1,h=!1,i=!1,k=/^[1-9]{1}(\.[0-9]+)?E{1}$/;0<f.length;)if(" "===f.substr(0,1))f=f.substr(1);else{"="===f.substr(0,1)&&(f=f.substr(1));break}for(;!(d>=f.length);)if(j)'"'===e()?'"'===f.substr(d+1,1)?(a+='"',d+=1):(j=!1,b.add(a,m,I),a=""):a+=e(),d+=1;else if(g)"'"===e()?"'"===f.substr(d+1,1)?(a+="'",d+=1):g=!1:a+=e(),d+=1;else if(h)"]"===
e()&&(h=!1),a+=e(),d+=1;else if(i)a+=e(),d+=1,-1!==",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,".indexOf(","+a+",")&&(i=!1,b.add(a,m,J),a="");else if(-1!=="+-".indexOf(e())&&1<a.length&&a.match(k))a+=e(),d+=1;else if('"'===e())0<a.length&&(b.add(a,z),a=""),j=!0,d+=1;else if("'"===e())0<a.length&&(b.add(a,z),a=""),g=!0,d+=1;else if("["===e())h=!0,a+=e(),d+=1;else if("#"===e())0<a.length&&(b.add(a,z),a=""),i=!0,a+=e(),d+=1;else if("{"===e())0<a.length&&(b.add(a,z),a=""),c.push(b.add("ARRAY",o,
r)),c.push(b.add("ARRAYROW",o,r)),d+=1;else if(";"===e())0<a.length&&(b.add(a,m),a=""),b.addRef(c.pop()),b.add(",",A),c.push(b.add("ARRAYROW",o,r)),d+=1;else if("}"===e())0<a.length&&(b.add(a,m),a=""),b.addRef(c.pop("ARRAYROWSTOP")),b.addRef(c.pop("ARRAYSTOP")),d+=1;else if(" "===e()){0<a.length&&(b.add(a,m),a="");b.add("",E);for(d+=1;" "===e()&&!(d>=f.length);)d+=1}else-1!==",>=,<=,<>,".indexOf(","+f.substr(d,2)+",")?(0<a.length&&(b.add(a,m),a=""),b.add(f.substr(d,2),u,B),d+=2):(-1!=="+-*/^&=><".indexOf(e())?
(0<a.length&&(b.add(a,m),a=""),b.add(e(),u)):-1!=="%".indexOf(e())?(0<a.length&&(b.add(a,m),a=""),b.add(e(),C)):"("===e()?0<a.length?(c.push(b.add(a,o,r)),a=""):c.push(b.add("",t,r)):","===e()?(0<a.length&&(b.add(a,m),a=""),c.type()!==o?b.add(e(),u,K):b.add(e(),A)):")"===e()?(0<a.length&&(b.add(a,m),a=""),b.addRef(c.pop())):a+=e(),d+=1);0<a.length&&b.add(a,m);for(c=new v;b.moveNext();)a=b.current(),a.type.toString()===E?(e=(e=(e=b.BOF()||b.EOF())&&(b.previous().type.toString()===o&&b.previous().subtype.toString()===
q||b.previous().type.toString()===t&&b.previous().subtype.toString()===q||b.previous().type.toString()===m))&&(b.next().type.toString()===o&&b.next().subtype.toString()===r||b.next().type.toString()===t&&b.next().subtype.toString()===r||b.next().type.toString()===m))&&c.add(a.value.toString(),u,L):c.addRef(a);for(;c.moveNext();)a=c.current(),a.type.toString()===u&&"-"===a.value.toString()?c.BOF()?a.type=F.toString():c.previous().type.toString()===o&&c.previous().subtype.toString()===q||c.previous().type.toString()===
t&&c.previous().subtype.toString()===q||c.previous().type.toString()===C||c.previous().type.toString()===m?a.subtype=D.toString():a.type=F.toString():a.type.toString()===u&&"+"===a.value.toString()?c.BOF()?a.type=l.toString():c.previous().type.toString()===o&&c.previous().subtype.toString()===q||c.previous().type.toString()===t&&c.previous().subtype.toString()===q||c.previous().type.toString()===C||c.previous().type.toString()===m?a.subtype=D.toString():a.type=l.toString():a.type.toString()===u&&
0===a.subtype.length?a.subtype=-1!=="<>=".indexOf(a.value.substr(0,1))?B.toString():"&"===a.value.toString()?M.toString():D.toString():a.type.toString()===m&&0===a.subtype.length?a.subtype=isNaN(parseFloat(a.value))?"TRUE"===a.value.toString()||"FALSE"===a.value.toString()?B.toString():G.toString():N.toString():a.type.toString()===o&&"@"===a.value.substr(0,1)&&(a.value=a.value.substr(1).toString());c.reset();for(b=new v;c.moveNext();)c.current().type.toString()!==l&&b.addRef(c.current());b.reset();
return b}function y(f,b,c,d,e,a){var a=void 0===typeof a||null===a?null:a,j=function(a){return a.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")},g="",g="text"===f.subtype||"text"===f.type?f.value.toString():(0===f.value.length?" ":f.value.toString()).split(" ").join("").toString();if("function"===typeof e&&(e=e(g,f,c,d),g=e.tokenString,!e.useTemplate))return g;switch(f.type){case "function":switch(f.value){case "ARRAY":g=i(j(b.tmplFunctionStartArray),
g,c,d);break;case "ARRAYROW":g=i(j(b.tmplFunctionStartArrayRow),g,c,d);break;default:g="start"===f.subtype.toString()?i(j(b.tmplFunctionStart),g,c,d):i(j(b.tmplFunctionStop),g,c,d)}break;case "operand":switch(f.subtype.toString()){case "error":g=i(j(b.tmplOperandError),g,c,d);break;case "range":g=i(j(b.tmplOperandRange),g,c,d);break;case "number":g=i(j(b.tmplOperandNumber),g,c,d);break;case "text":g=i(j(b.tmplOperandText),g,c,d);break;case "argument":g=i(j(b.tmplArgument),g,c,d)}break;case "operator-infix":case "logical":g=
i(j(b.tmplOperandLogical),g,c,d);break;case "argument":g="argument"!==a.type?i(j(b.tmplArgument),g,c,d):i(j("{{autoindent}}"+b.tmplArgument),g,c,d);break;case "subexpression":g="start"===f.subtype.toString()?i(j(b.tmplSubexpressionStart),g,c,d):i(j(b.tmplSubexpressionStop),g,c,d)}return g}"undefined"===typeof window&&(window=root);var h=window.excelFormulaUtilities=window.excelFormulaUtilities||{},n=window.excelFormulaUtilities.core,i=window.excelFormulaUtilities.string.formatStr,p=window.excelFormulaUtilities.string.trim,
k={},l=k.TOK_TYPE_NOOP="noop",m=k.TOK_TYPE_OPERAND="operand",o=k.TOK_TYPE_FUNCTION="function",t=k.TOK_TYPE_SUBEXPR="subexpression",A=k.TOK_TYPE_ARGUMENT="argument",F=k.TOK_TYPE_OP_PRE="operator-prefix",u=k.TOK_TYPE_OP_IN="operator-infix",C=k.TOK_TYPE_OP_POST="operator-postfix",E=k.TOK_TYPE_WSPACE="white-space",z=k.TOK_TYPE_UNKNOWN="unknown",r=k.TOK_SUBTYPE_START="start",q=k.TOK_SUBTYPE_STOP="stop",I=k.TOK_SUBTYPE_TEXT="text",N=k.TOK_SUBTYPE_NUMBER="number",B=k.TOK_SUBTYPE_LOGICAL="logical",J=k.TOK_SUBTYPE_ERROR=
"error",G=k.TOK_SUBTYPE_RANGE="range",D=k.TOK_SUBTYPE_MATH="math",M=k.TOK_SUBTYPE_CONCAT="concatenate",L=k.TOK_SUBTYPE_INTERSECT="intersect",K=k.TOK_SUBTYPE_UNION="union";h.parseFormula=function(f,b){var c=0,d=document.getElementById(f),e=w(d.value),a;for(a="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'><tr><td class='token' style='font-weight: bold; width: 50px'>index</td><td class='token' style='font-weight: bold; width: 125px'>type</td><td class='token' style='font-weight: bold; width: 125px'>subtype</td><td class='token' style='font-weight: bold; width: 150px'>token</td><td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";e.moveNext();){var j=
e.current();j.subtype===q&&(c-=0<c?1:0);a+="<tr>";a+="<td class='token'>"+(e.index+1)+"</td>";a+="<td class='token'>"+j.type+"</td>";a+="<td class='token'>"+(0===j.subtype.length?"&nbsp;":j.subtype.toString())+"</td>";a+="<td class='token'>"+(0===j.value.length?"&nbsp;":j.value).split(" ").join("&nbsp;")+"</td>";for(var g="|",h=0;h<c;h+=1)g+="&nbsp;&nbsp;&nbsp;|";a+="<td class='token'>"+g+(0===j.value.length?"&nbsp;":j.value).split(" ").join("&nbsp;")+"</td>";a+="</tr>";j.subtype===r&&(c+=1)}document.getElementById(b).innerHTML=
a+"</table>";d.select();d.focus()};var H=h.formatFormula=function(f,b){for(var c={tmplFunctionStart:"{{autoindent}}{{token}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:" {{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",
tmplSubexpressionStart:"{{autoindent}}(\n",tmplSubexpressionStop:"\n)",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",customTokenRender:null,prefix:"",postfix:""},b=b?n.extend(!0,c,b):c,c=0,d=w(f),e="",a=b.autoLineBreak.replace(/\s/gi,"").split("|"),j=!0,g=null;d.moveNext();){var h=d.current(),i=d.next();h.subtype.toString()===q&&(c-=0<c?1:0);var m=RegExp(b.newLine+"$","");a:{for(var l=0;l<a.length;l+=
1)if(null!==i&&"undefined"!==typeof i&&(k[a[l]]===i.type.toString()||k[a[l]]===i.subtype.toString())){i=!0;break a}i=!1}if(j){j="";for(l=0;l<c;l+=1)j+=b.tmplIndentTab}else j=b.tmplIndentSpace;e+=y(h,b,j,i?b.newLine:"",b.customTokenRender,g);h.subtype.toString()===r&&(c+=1);j=i||m.test(e);g=h}return e=b.prefix+p(e)+b.postfix};h.formatFormulaHTML=function(f){return H(f,{tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><span class="function_start">(</span><br />',tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',
tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',tmplArgument:"{{token}}<br />",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",
tmplIndentTab:'<span class="tabbed">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:!0,prefix:"=",customTokenRender:null})};var O=h.formula2CSharp=function(f){var b=[];return H(f,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',
tmplArgument:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",trim:!0,customTokenRender:function(c,d){var e="",a={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},f=b[b.length-1],g=!1;switch(d.type.toString()){case o:switch(d.subtype){case r:b.push({name:c,
argumentNumber:0});e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c;g=!0;break;case q:g=!0;switch(f.name.toLowerCase()){case "if":e=")";g=!1;break;default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c}b.pop()}break;case A:switch(f.name.toLowerCase()){case "if":switch(f.argumentNumber){case 0:e="?";break;case 1:e=":"}break;case "sum":e="+";break;default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c,g=!0}f.argumentNumber+=1;break;case m:switch(d.subtype){case G:switch(f.name.toLowerCase()){case "sum":if(/\w{1,4}\d+:\w{1,4}\d+/gi.test("A1:B2"))throw"This is not a valid range: "+
c;ranges=c.split(":");startRow=range[0].match(/[0-9]+/gi)[0];startCol=range[0].match(/[A-Z]+/gi)[0];endRow=range[1].match(/[0-9]+/gi)[0];endCol=range[1].match(/[A-Z]+/gi)[0];debugger}break}default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c,g=!0}return{tokenString:e,useTemplate:g}}})};h.formula2JavaScript=function(f){return O(f).replace("==","===")};h.getTokens=w})();
