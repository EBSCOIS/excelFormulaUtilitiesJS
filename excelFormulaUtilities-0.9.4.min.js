(function(){"undefined"===typeof window&&(window=root);window.excelFormulaUtilities=window.excelFormulaUtilities||{};var r=window.excelFormulaUtilities.core={};window.excelFormulaUtilities.string=window.excelFormulaUtilities.string||{};window.excelFormulaUtilities.string.formatStr=function(i){for(var m=i,h=1;h<arguments.length;h++)m=m.replace(RegExp("\\{{1}"+(h-1).toString()+"{1}\\}{1}","g"),arguments[h]);return m};window.excelFormulaUtilities.string.trim=function(i){return i.replace(/^\s|\s$/,"")};
window.excelFormulaUtilities.string.trim=function(i){return i.replace(/^(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*|(?:\s|&nbsp;|<\s*br\s*\/*\s*>)*$/,"")};var u=r.isFunction=function(i){return"function"===typeof i},w=r.isArray=function(i){return"object"===typeof i&&i.length},v=r.isWindow=function(){return obj&&"object"===typeof obj&&"setInterval"in obj},x=r.isPlainObject=function(i){if(!i||("object"!==typeof i||i.nodeType||v(i))||i.constructor&&!hasOwnProperty.call(i,"constructor")&&!hasOwnProperty.call(i.constructor.prototype,
"isPrototypeOf"))return!1;for(var m in i);return void 0===m||hasOwnProperty.call(i,m)};r.extend=function(){var i,m,h,o,j,k=arguments[0]||{},l=1,n=arguments.length,s=!1;"boolean"===typeof k&&(s=k,k=arguments[1]||{},l=2);"object"!==typeof k&&!u(k)&&(k={});n===l&&(k=this,--l);for(;l<n;l++)if(null!=(i=arguments[l]))for(m in i)h=k[m],o=i[m],k!==o&&(s&&o&&(x(o)||(j=w(o)))?(j?(j=!1,h=h&&w(h)?h:[]):h=h&&x(h)?h:{},k[m]=r.extend(s,h,o)):void 0!==o&&(k[m]=o));return k}})();(function(){function r(g,b,c){this.value=g;this.type=b;this.subtype=c}function u(){this.items=[];this.add=function(g,b,c){c||(c="");g=new r(g,b,c);this.addRef(g);return g};this.addRef=function(g){this.items.push(g)};this.index=-1;this.reset=function(){this.index=-1};this.BOF=function(){return 0>=this.index};this.EOF=function(){return this.index>=this.items.length-1};this.moveNext=function(){if(this.EOF())return!1;this.index+=1;return!0};this.current=function(){return-1===this.index?null:this.items[this.index]};
this.next=function(){return this.EOF()?null:this.items[this.index+1]};this.previous=function(){return 1>this.index?null:this.items[this.index-1]}}function w(){this.items=[];this.push=function(g){this.items.push(g)};this.pop=function(g){var b=this.items.pop();return new r(g||"",b.type,p)};this.token=function(){return 0<this.items.length?this.items[this.items.length-1]:null};this.value=function(){return this.token()?this.token().value.toString():""};this.type=function(){return this.token()?this.token().type.toString():
""};this.subtype=function(){return this.token()?this.token().subtype.toString():""}}function v(g){for(var b=new u,c=new w,d=0,e=function(){return g.substr(d,1)},a="",f=!1,i=!1,h=!1,j=!1,m=/^[1-9]{1}(\.[0-9]+)?E{1}$/;0<g.length;)if(" "===g.substr(0,1))g=g.substr(1);else{"="===g.substr(0,1)&&(g=g.substr(1));break}for(;!(d>=g.length);)if(f)'"'===e()?'"'===g.substr(d+1,1)?(a+='"',d+=1):(f=!1,b.add(a,l,H),a=""):a+=e(),d+=1;else if(i)"'"===e()?"'"===g.substr(d+1,1)?(a+="'",d+=1):i=!1:a+=e(),d+=1;else if(h)"]"===
e()&&(h=!1),a+=e(),d+=1;else if(j)a+=e(),d+=1,-1!==",#NULL!,#DIV/0!,#VALUE!,#REF!,#NAME?,#NUM!,#N/A,".indexOf(","+a+",")&&(j=!1,b.add(a,l,I),a="");else if(-1!=="+-".indexOf(e())&&1<a.length&&a.match(m))a+=e(),d+=1;else if('"'===e())0<a.length&&(b.add(a,y),a=""),f=!0,d+=1;else if("'"===e())0<a.length&&(b.add(a,y),a=""),i=!0,d+=1;else if("["===e())h=!0,a+=e(),d+=1;else if("#"===e())0<a.length&&(b.add(a,y),a=""),j=!0,a+=e(),d+=1;else if("{"===e())0<a.length&&(b.add(a,y),a=""),c.push(b.add("ARRAY",n,
q)),c.push(b.add("ARRAYROW",n,q)),d+=1;else if(";"===e())0<a.length&&(b.add(a,l),a=""),b.addRef(c.pop()),b.add(",",z),c.push(b.add("ARRAYROW",n,q)),d+=1;else if("}"===e())0<a.length&&(b.add(a,l),a=""),b.addRef(c.pop("ARRAYROWSTOP")),b.addRef(c.pop("ARRAYSTOP")),d+=1;else if(" "===e()){0<a.length&&(b.add(a,l),a="");b.add("",D);for(d+=1;" "===e()&&!(d>=g.length);)d+=1}else-1!==",>=,<=,<>,".indexOf(","+g.substr(d,2)+",")?(0<a.length&&(b.add(a,l),a=""),b.add(g.substr(d,2),t,A),d+=2):(-1!=="+-*/^&=><".indexOf(e())?
(0<a.length&&(b.add(a,l),a=""),b.add(e(),t)):-1!=="%".indexOf(e())?(0<a.length&&(b.add(a,l),a=""),b.add(e(),B)):"("===e()?0<a.length?(c.push(b.add(a,n,q)),a=""):c.push(b.add("",s,q)):","===e()?(0<a.length&&(b.add(a,l),a=""),c.type()!==n?b.add(e(),t,J):b.add(e(),z)):")"===e()?(0<a.length&&(b.add(a,l),a=""),b.addRef(c.pop())):a+=e(),d+=1);0<a.length&&b.add(a,l);for(c=new u;b.moveNext();)a=b.current(),a.type.toString()===D?(e=(e=(e=b.BOF()||b.EOF())&&(b.previous().type.toString()===n&&b.previous().subtype.toString()===
p||b.previous().type.toString()===s&&b.previous().subtype.toString()===p||b.previous().type.toString()===l))&&(b.next().type.toString()===n&&b.next().subtype.toString()===q||b.next().type.toString()===s&&b.next().subtype.toString()===q||b.next().type.toString()===l))&&c.add(a.value.toString(),t,K):c.addRef(a);for(;c.moveNext();)a=c.current(),a.type.toString()===t&&"-"===a.value.toString()?c.BOF()?a.type=E.toString():c.previous().type.toString()===n&&c.previous().subtype.toString()===p||c.previous().type.toString()===
s&&c.previous().subtype.toString()===p||c.previous().type.toString()===B||c.previous().type.toString()===l?a.subtype=C.toString():a.type=E.toString():a.type.toString()===t&&"+"===a.value.toString()?c.BOF()?a.type=k.toString():c.previous().type.toString()===n&&c.previous().subtype.toString()===p||c.previous().type.toString()===s&&c.previous().subtype.toString()===p||c.previous().type.toString()===B||c.previous().type.toString()===l?a.subtype=C.toString():a.type=k.toString():a.type.toString()===t&&
0===a.subtype.length?a.subtype=-1!=="<>=".indexOf(a.value.substr(0,1))?A.toString():"&"===a.value.toString()?L.toString():C.toString():a.type.toString()===l&&0===a.subtype.length?a.subtype=isNaN(parseFloat(a.value))?"TRUE"===a.value.toString()||"FALSE"===a.value.toString()?A.toString():F.toString():M.toString():a.type.toString()===n&&"@"===a.value.substr(0,1)&&(a.value=a.value.substr(1).toString());c.reset();for(b=new u;c.moveNext();)c.current().type.toString()!==k&&b.addRef(c.current());b.reset();
return b}function x(g,b,c,d,e){var a=function(a){return a.replace(/\{\{token\}\}/gi,"{0}").replace(/\{\{autoindent\}\}/gi,"{1}").replace(/\{\{autolinebreak\}\}/gi,"{2}")},f="",f="text"===g.subtype||"text"===g.type?g.value.toString():(0===g.value.length?" ":g.value.toString()).split(" ").join("").toString();if("function"===typeof e&&(e=e(f,g,c,d),f=e.tokenString,!e.useTemplate))return f;switch(g.type){case "function":switch(g.value){case "ARRAY":f=h(a(b.tmplFunctionStartArray),f,c,d);break;case "ARRAYROW":f=
h(a(b.tmplFunctionStartArrayRow),f,c,d);break;default:f="start"===g.subtype.toString()?h(a(b.tmplFunctionStart),f,c,d):h(a(b.tmplFunctionStop),f,c,d)}break;case "operand":switch(g.subtype.toString()){case "error":f=h(a(b.tmplOperandError),f,c,d);break;case "range":f=h(a(b.tmplOperandRange),f,c,d);break;case "number":f=h(a(b.tmplOperandNumber),f,c,d);break;case "text":f=h(a(b.tmplOperandText),f,c,d);break;case "argument":f=h(a(b.tmplArgument),f,c,d)}break;case "operator-infix":case "logical":f=h(a(b.tmplOperandLogical),
f,c,d);break;case "argument":f=h(a(b.tmplArgument),f,c,d);break;case "subexpression":f="start"===g.subtype.toString()?h(a(b.tmplSubexpressionStart),f,c,d):h(a(b.tmplSubexpressionStop),f,c,d)}return f}"undefined"===typeof window&&(window=root);var i=window.excelFormulaUtilities=window.excelFormulaUtilities||{},m=window.excelFormulaUtilities.core,h=window.excelFormulaUtilities.string.formatStr,o=window.excelFormulaUtilities.string.trim,j={},k=j.TOK_TYPE_NOOP="noop",l=j.TOK_TYPE_OPERAND="operand",n=
j.TOK_TYPE_FUNCTION="function",s=j.TOK_TYPE_SUBEXPR="subexpression",z=j.TOK_TYPE_ARGUMENT="argument",E=j.TOK_TYPE_OP_PRE="operator-prefix",t=j.TOK_TYPE_OP_IN="operator-infix",B=j.TOK_TYPE_OP_POST="operator-postfix",D=j.TOK_TYPE_WSPACE="white-space",y=j.TOK_TYPE_UNKNOWN="unknown",q=j.TOK_SUBTYPE_START="start",p=j.TOK_SUBTYPE_STOP="stop",H=j.TOK_SUBTYPE_TEXT="text",M=j.TOK_SUBTYPE_NUMBER="number",A=j.TOK_SUBTYPE_LOGICAL="logical",I=j.TOK_SUBTYPE_ERROR="error",F=j.TOK_SUBTYPE_RANGE="range",C=j.TOK_SUBTYPE_MATH=
"math",L=j.TOK_SUBTYPE_CONCAT="concatenate",K=j.TOK_SUBTYPE_INTERSECT="intersect",J=j.TOK_SUBTYPE_UNION="union";i.parseFormula=function(g,b){var c=0,d=document.getElementById(g),e=v(d.value),a;for(a="<table cellspacing='0' style='border-top: 1px #cecece solid; margin-top: 5px; margin-bottom: 5px'><tr><td class='token' style='font-weight: bold; width: 50px'>index</td><td class='token' style='font-weight: bold; width: 125px'>type</td><td class='token' style='font-weight: bold; width: 125px'>subtype</td><td class='token' style='font-weight: bold; width: 150px'>token</td><td class='token' style='font-weight: bold; width: 300px'>token tree</td></tr>";e.moveNext();){var f=
e.current();f.subtype===p&&(c-=0<c?1:0);a+="<tr>";a+="<td class='token'>"+(e.index+1)+"</td>";a+="<td class='token'>"+f.type+"</td>";a+="<td class='token'>"+(0===f.subtype.length?"&nbsp;":f.subtype.toString())+"</td>";a+="<td class='token'>"+(0===f.value.length?"&nbsp;":f.value).split(" ").join("&nbsp;")+"</td>";for(var i="|",h=0;h<c;h+=1)i+="&nbsp;&nbsp;&nbsp;|";a+="<td class='token'>"+i+(0===f.value.length?"&nbsp;":f.value).split(" ").join("&nbsp;")+"</td>";a+="</tr>";f.subtype===q&&(c+=1)}document.getElementById(b).innerHTML=
a+"</table>";d.select();d.focus()};var G=i.formatFormula=function(g,b){for(var c={tmplFunctionStart:"{{autoindent}}{{token}}\n{{autoindent}}(\n",tmplFunctionStop:"\n{{autoindent}}{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}"{{token}}"',tmplArgument:"{{token}}\n",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",
tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",newLine:"\n",trim:!0,customTokenRender:null},b=b?m.extend(!0,c,b):c,c=0,d=v(g),e="",a=b.autoLineBreak.replace(/\s/gi,"").split("|"),f=!0;d.moveNext();){var i=d.current(),h=d.next();i.subtype.toString()===p&&(c-=0<c?1:0);var l=RegExp(b.newLine+"$","");a:{for(var k=0;k<a.length;k+=
1)if(null!==h&&"undefined"!==typeof h&&(j[a[k]]===h.type.toString()||j[a[k]]===h.subtype.toString())){h=!0;break a}h=!1}if(f){f="";for(k=0;k<c;k+=1)f+=b.tmplIndentTab}else f=b.tmplIndentSpace;e+=x(i,b,f,h?b.newLine:"",b.customTokenRender);i.subtype.toString()===q&&(c+=1);f=h||l.test(e)}return b.trim?o(e):e};i.formatFormulaHTML=function(g){return G(g,{tmplFunctionStart:'{{autoindent}}<span class="function">{{token}}</span><br />{{autoindent}}<span class="function_start">(</span><br />',tmplFunctionStop:'<br />{{autoindent}}{{token}}<span class="function_stop">)</span>',
tmplOperandError:"{{token}}",tmplOperandRange:"{{autoindent}}{{token}}",tmplOperandLogical:" {{token}}{{autolinebreak}}",tmplOperandNumber:"{{autoindent}}{{token}}",tmplOperandText:'{{autoindent}}<span class="quote_mark">"</span><span class="text">{{token}}</span><span class="quote_mark">"</span>',tmplArgument:"{{token}}<br />",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"{{autoindent}}(",tmplSubexpressionStop:" )",
tmplIndentTab:'<span class="tabs">&nbsp;&nbsp;&nbsp;&nbsp;</span>',tmplIndentSpace:"&nbsp;",newLine:"<br />",autoLineBreak:"TOK_TYPE_FUNCTION | TOK_TYPE_ARGUMENT | TOK_SUBTYPE_LOGICAL | TOK_TYPE_OP_IN ",trim:!0,customTokenRender:null})};var N=i.formula2CSharp=function(g){var b=[];return G(g,{tmplFunctionStart:"{{token}}(",tmplFunctionStop:"{{token}})",tmplOperandError:"{{token}}",tmplOperandRange:"{{token}}",tmplOperandLogical:"{{token}}",tmplOperandNumber:"{{token}}",tmplOperandText:'"{{token}}"',
tmplArgument:"{{token}}",tmplFunctionStartArray:"",tmplFunctionStartArrayRow:"{",tmplFunctionStopArrayRow:"}",tmplFunctionStopArray:"",tmplSubexpressionStart:"(",tmplSubexpressionStop:")",tmplIndentTab:"\t",tmplIndentSpace:" ",autoLineBreak:"TOK_SUBTYPE_STOP | TOK_SUBTYPE_START | TOK_TYPE_ARGUMENT",trim:!0,customTokenRender:function(c,d){var e="",a={"=":"==","<>":"!=",MIN:"Math.Min",MAX:"Math.Max",ABS:"Math.ABS",SUM:"",IF:"","&":"+"},f=b[b.length-1],g=!1;switch(d.type.toString()){case n:switch(d.subtype){case q:b.push({name:c,
argumentNumber:0});e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c;g=!0;break;case p:g=!0;switch(f.name.toLowerCase()){case "if":e=")";g=!1;break;default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c}b.pop()}break;case z:switch(f.name.toLowerCase()){case "if":switch(f.argumentNumber){case 0:e="?";break;case 1:e=":"}break;case "sum":e="+";break;default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c,g=!0}f.argumentNumber+=1;break;case l:switch(d.subtype){case F:switch(f.name.toLowerCase()){case "sum":if(/\w{1,4}\d+:\w{1,4}\d+/gi.test("A1:B2"))throw"This is not a valid range: "+
c;ranges=c.split(":");startRow=range[0].match(/[0-9]+/gi)[0];startCol=range[0].match(/[A-Z]+/gi)[0];endRow=range[1].match(/[0-9]+/gi)[0];endCol=range[1].match(/[A-Z]+/gi)[0];debugger}break}default:e="string"===typeof a[c.toUpperCase()]?a[c.toUpperCase()]:c,g=!0}return{tokenString:e,useTemplate:g}}})};i.formula2JavaScript=function(g){return N(g).replace("==","===")};i.getTokens=v})();
